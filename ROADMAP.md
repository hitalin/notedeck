# NoteDeck Roadmap

## ポジショニング

NoteDeck は Misskey Web UI の **代替** ではなく **補完** である。

ターゲットは「複数サーバーのタイムラインを常時監視するパワーユーザー」。
この層の **日常操作の 80% をデスクトップ内で完結** させ、Web UI を開く頻度を最小化することがゴール。

## 設計原則

- Apple 式直感 UI: 設定項目を増やさず、触ればわかる操作で完結
- 機能網羅より体験品質: 少ない機能を心地よく使えることを優先
- Web UI へのリンク導線: 非対応機能はブラウザで開けるようにする

---

## 構造的に対応しない領域

低頻度・管理系の操作は Web UI の責務とし、実装しない。

| 領域 | 理由 |
|---|---|
| 管理画面 | サーバー管理は Web UI 固有の責務 |
| プロフィール編集 | 年に数回の操作。Web UI リンクで十分 |
| ドライブ管理 | ファイル整理は Web UI の仕事。投稿時アップロードのみ対応 |
| ページ / Play | コンテンツ作成ツール。実装コストに見合わない |
| ウィジェット | Web UI のダッシュボード機能。デッキ UI と設計思想が異なる |
| フォロー管理画面 | 一覧表示・整理は Web UI で。フォロー操作のみ対応 |
| 設定画面の網羅 | Misskey 本家の膨大な設定項目は Apple 式の思想と矛盾 |

**判断基準**: 月 1 回以下の操作 / 作成・管理系 / Web UI リンクで代替可能

---

## Phase 1: 生存条件 — Web UI に戻らせない（カラム種別の拡充）

日常ループ（閲覧・反応・会話）を途切れさせない機能を揃える。
これが欠けると「結局 Web UI でいいや」になる。

- [x] タイムライン（HTL / LTL / STL / GTL / カスタム）
- [x] 通知カラム（リアルタイム）
- [x] 検索カラム
- [x] 投稿（テキスト・CW・公開範囲・ファイル添付・投票・編集）
- [x] リアクション / リプライ / リノート / 引用
- [x] フォロー / アンフォロー
- [x] リストカラム
- [x] アンテナカラム
- [x] ダイレクト投稿カラム（visibility: specified）
- [x] チャットカラム（Misskey v2025.2.0+ chat API、リアルタイム WS 対応）
- [x] クリップカラム
- [x] ユーザーノート一覧カラム
- [x] メンションカラム
- [x] チャンネルカラム
- [x] お気に入りカラム

**Phase 1 完了** — 全 12 種類のカラムが揃い、日常操作のカバー率は目標に到達。

---

## Phase 2: 唯一無二の価値 — デスクトップアプリだからこそ

Phase 1 で蓄積されたローカルキャッシュの上に、Web UI では原理的に不可能な機能を載せる。

- [ ] **横断検索** — 複数サーバー × 全カラムのノートを SQLite FTS で横断検索。
  サーバー A のリスト + サーバー B のアンテナ + サーバー C の HTL をまたいだ検索は NoteDeck だけの体験
- [ ] **未読管理 / マーカー** — 常駐アプリならではの「どこまで読んだか」追跡。
  ブラウザタブでは閉じたら消えるが、デスクトップアプリは状態を保持できる

**前提条件クリア**: Phase 1 で全カラム種別が揃い、複数サーバー × 多様なカラムからノートが
SQLite に蓄積される基盤が完成。横断検索の対象データが十分に蓄積される状態になった。

---

## Phase 3: Hackable — 「知っている人だけが使える」拡張性

mikutter が Ruby プラグインで熱狂的コミュニティを形成したように、
NoteDeck をヘビーユーザーが「自分の道具」として育てられるアプリにする。

**設計方針**: Apple 式の直感 UI と矛盾しないよう、拡張機能は通常の UI に露出させない。
設定の奥、またはファイル配置でのみ有効化される。**知っている人だけが使える。**

### 3a. 見た目のカスタマイズ（低コスト・即効性）

- [ ] **カスタム CSS 注入** — 設定画面から自由な CSS を入力し、アプリ全体に適用。
  Misskey 本家の「カスタム CSS」と同じ体験。既存の Misskey カスタム CSS をそのまま流用可能にする
- [ ] **テーマシステム** — Misskey のテーマ JSON 形式と互換のあるテーマ切替。
  CSS カスタムプロパティベースで、インポート / エクスポートに対応
- [ ] **カラム個別スタイル** — カラムごとに背景色やフォントサイズを変更可能。
  多カラム運用時の視覚的な区別に有効

### 3b. 操作のカスタマイズ（中コスト・高い訴求力）

- [ ] **キーバインドカスタマイズ** — ショートカットキーの自由なリマップ。
  設定ファイル (`keybindings.json`) で定義し、Vim 風バインドも自作可能
- [ ] **ユーザースクリプト** — `~/.config/notedeck/scripts/` に JS ファイルを配置するだけでロード。
  mikutter の「`.rb` を置くだけ」と同じ思想。`window.notedeck` 名前空間に API を公開
- [ ] **ノートアクション拡張** — ノートメニューにカスタムアクションを追加するフック。
  Misskey の `Plugin:register_note_action` 相当。「外部サービスに送る」「翻訳する」等
- [ ] **投稿フォーム拡張** — 投稿前にテキストを変換するフック。
  Misskey の `Plugin:register_note_post_interruptor` 相当。定型文挿入・自動ハッシュタグ等
- [ ] **外部コマンド連携** — ノート内容を外部コマンドにパイプし結果を受け取る Unix 哲学的な連携。
  Tauri の Rust バックエンドを活かし、OS のコマンドラインツール全てを利用可能

### 3c. プラグインエコシステム（高コスト・長期ビジョン）

- [ ] **プラグイン API + マニフェスト** — `manifest.json` でメタデータ（名前・バージョン・権限）を宣言し、
  JS + CSS のバンドルとして配布。3a〜3b の拡張ポイントを正式仕様に収斂させる
- [ ] **AiScript ランタイム統合** — @syuilo/aiscript の JS 実装を WebView 内で実行し、
  Misskey Plugin API (`Plugin:*`, `Mk:*`) の互換レイヤーを提供。既存プラグインがそのまま動く世界
- [ ] **カスタムカラムタイプ** — ユーザーがデータソース + 表示テンプレートを定義して独自カラムを作成。
  デッキクライアントの到達点。mikutter の「なんでもタブ化」に相当
- [ ] **プラグインリポジトリ** — アプリ内からプラグインを検索・インストールできる UI。
  mikutter の miqhub に相当。エコシステムの発見可能性が成長の鍵

**先行事例と技術基盤**:
- mikutter: 全機能がプラグイン。Pluggaloid (Ruby) によるイベント駆動。ファイル配置でロード
- Misskey 本家: AiScript + Plugin API + カスタム CSS + テーマ JSON。ユーザーは既にこの文化に馴染んでいる
- Zed エディタ: WASM サンドボックスでプラグインを安全に実行するモデル
- Tauri v2: `initialization_script` / `webview.eval()` で JS 注入可能。FS プラグインでディレクトリ走査

---

## 将来の検討材料

優先度は低いが、技術的に興味深い方向性。

| 項目 | メモ |
|---|---|
| AiScript エディタ / Play 実行 | @syuilo/aiscript をそのまま利用。webview 内で完結するためRust実装(aiscript-rs)は不要。Monaco/CodeMirror + 本家パーサーで構文チェック・補完・実行プレビューを提供 |
| iOS 対応 | Apple Developer Program ($99/年) + Mac ビルド環境が障壁 |
